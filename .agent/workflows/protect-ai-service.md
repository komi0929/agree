---
description: AIサービスコア（ai-service.ts）の編集に関する絶対的保護ルール
---

# 🚨 CRITICAL: ai-service.ts 編集保護プロトコル

## 絶対に守るべきルール

**以下のファイルは、このサービスの核心であり、いかなる理由があっても独断で編集してはならない：**

```
lib/ai-service.ts
```

## 編集が許可される条件

### 1. ユーザーからの明示的な指示があった場合でも

必ず以下の確認を行うこと：

```
⚠️ 注意: lib/ai-service.ts はチェック精度の根幹です。
この編集により、契約書チェックの精度に影響が出る可能性があります。

本当に編集してよろしいですか？

変更内容: [具体的な変更内容を記載]
影響範囲: [影響を受ける機能を記載]
```

### 2. ユーザーが「はい」「進めて」等の明確な承認をした場合のみ編集可能

## このルールの背景

2026年1月7日、スピード最適化の過程でStreaming APIのプロンプトを「簡略化」した結果、契約書チェックの検出件数が10件超 → 3件に激減するという重大な精度低下が発生した。

これは法的リスクを見逃す可能性があり、サービスの存在意義を損なう致命的な問題である。

## 関連する保護対象ファイル

以下のファイルも同様に慎重に扱うこと：

- `lib/ai-service.ts` - AIプロンプトと解析ロジック（最重要）
- `lib/rules/rule-checker.ts` - ルールベースチェックロジック  
- `lib/prompts/` - プロンプト関連ファイル
- `lib/knowledge/known-bad-patterns.ts` - 危険パターン定義

## チェック精度に関するドキュメント

精度に関する変更を行う場合は、必ず以下のワークフローを確認すること：

```
/contract-check-accuracy
```
